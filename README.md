# Vinyla-Shake
Turn Table / Audio Mixing / App

🔗 [배포](https://tangerine-cannoli-725cf0.netlify.app
)

(⛔️ iOS앱을 타켓으로 한 RN의 WebView 기반 개발로 safari 환경에서 실행 권장)

# 💡개발 동기

* 평소 개발 공부를 하면서 DJ Mix set 음악을 많이 들었는데, 음악 들으면서 도움도 많이 받았고, 장비들에 대한 호기심으로 시작하게 됐습니다. 
*  앱 개발에 대한 관심과 평소 DJ mix 앱에서 아쉬웠던 점인 user의 커스텀이 된 소리들을 넣으면 더 재밌지 않을까 생각했습니다.
* 대부분의 DJ앱은 유저의 음악파일에 직접 접근해서 가져오는데, 파일들중에 mp3 확장자로 되어있는 파일이 있다면 사용할 수 있도록 구현했습니다.

# 🛠 선택 기술

* Expo Go
* ES6
* storybook
* jest

# 🤷🏻‍♂️ 기술 선택 이유

* Expo Go
	* 앱 개발이 처음이고 빠르고 간단하게 개발환경 설정해주는 장점
	* WebView를 사용하기 때문에 React-Native의 라이브러리를 사용할 것들이 없어서 Expo Go로 결정.
* WebView?
	* 프로젝트에서 브라우저에서 제공하는 기본 Web Audio API 사용이 필수인데, Expo에서 제공하는 SDK(expo-av)가 Web Audio API의 기능들에 비해 적어서 WebView로 선택.
* Story Book
  * 시각적인 요소들이 대부분인 앱에서 부분별, UI테스트하기 적합하다고 판단.
* Vanilla JS (ES6)
	* React사용을 고민하다가 화면 전환이 필요없는 싱글 페이지이고, 지속적으로 변경되는 부분이 vinyl과 canvas(sound bar) 부분이라서, state변화에 따른 렌더링과 life cycle을 고민해야되는 React 사용보다는 vanilla JS를 사용하는게 더 적절하다고 판단했다.
  * 다른 라이브러리들을 많이 사용해서 그 라이브러리에 의존하기 보다는 JS만 사용해서 최대한 스스로 많이 구현해보고 싶었다.

# 실행 화면

| 처음 화면  | 음악 가져오기 | 음악실행 / 녹음 | FX 버튼조작 | 녹음 리스트
|--|--|--|--|--|
| <img src="/assets/기본.jpg" /> | <img src="/assets/음악가져오기.jpg"/> | <img src="/assets/녹음.jpg" /> | <img src="/assets/FX버튼.jpeg" /> | <img src="/assets/녹음결과.jpg" /> |

# 🚬 고민들, 문제 해결과정

<details>
<summary>Vinyl 회전</summary>
<div markdown="1">

* Vinyl이 360도 회전하기 때문에 오른쪽 방향이라도 아랫쪽에선 역방향이고, 윗쪽에서는 정방향이듯, 위치에 따른 차이를 구분해주어야 했다.
* 처음엔 위치를 나눠 구분하려했지만, 좋지 못한 방법이였고, 고민을 하고 레퍼런스들을 찾아보다가 크게 2방향으로만 나눴다.
* 우선, x축과 y축 방향 중 더 큰 움직임이 있는 곳을 구한다. (delta X, delta Y)
* X축 움직임이 더 크다면, 터치가 생긴 곳의 위치를 Vinyl크기 기준으로 파악한다.
* 터치한 위치(e.offsetY)가 Vinyl 크기 절반보다 작으면 윗쪽이고, 크면 아랫쪽이다.
* 윗쪽이면 delta X의 양수가 정방향이고, 음수면 역방향이다.
* 같은 로직으로 Y축 움직임이 더 클 경우도 적용시켜서 구현했다.

</div>
</details>

<details>
<summary>MVC와 Observer 패턴</summary>
<div markdown="1"> 

* 처음에는 함수형 프로그래밍을 적용시키려고 했지만, 부족한 조사와 경험으로 뒤늦게 함수형프로그래밍이 현재 프로젝트에 적합하지 않다는 것을 깨닫고, 다시 여러 디자인 패턴들을 현재 나의 프로젝트에 적합한지 더 자세히 조사해보고 선택하게 됐다.

* Observer 패턴을 선택한 이유는 audio context의 상태가 변함에 따라 vinyl, sound bars, record와 같은 컴포넌트들이 영향을 받아야 하기때문에 선택했다.

* 하나의 상태의 변화에 따라 다른 요소들이 독립적으로 변화에 따른 영향을 받는게 Observer 패턴을 적용시키는 데 적절한 것이라고 판단했다. 

* MVC를 나누는 것은 리액트의 state관리하듯 Model을 구성하고, 화면에 나오는 부분들은 View 클래스에, state에 데이터를 가공하는 곳은 Controller 클래스로 전체 구성을 구현해서 적용시켰다.

* Observer 패턴을 적용시킬땐,  observable한 객체와 observer로 설정할 것을 나눠서 observable 객체의 상태가 변할때 마다 notify를 해주어서 observer에게 알려주고, 상태 변화에 맞는 행동을 하는 로직으로 구현했다.

* 주로 AudioComponent가 Observable한 객체였고, 노래가 바뀔때마다 영향을 받는 요소들인 Vinyl Component, Sound bars, Effect Component들을 observer로 설정해두었다. 

* 처음 Web Audio Context에 대한 이해가 부족해서 먼저 어느정도 기능을 구현을 하고, 리팩토링을 하면서 디자인 패턴들을 적용시켰다.

* 리팩토링할때는 구조 나누는 것도 적용시키는 것도 너무 힘들었지만, 이후에 코드를 수정하거나 기능들을 추가할때, 너무 편하게 코드를 적을 수 있었다. 

* 전체 코드들이 눈에 들어오고, 어디에서 무슨 코드들이 있는지가 머릿속에 전부 있었다.

* 프로젝트에 맞는 적절한 디자인 패턴이 유지보수에 큰 도움이 된다는 걸 깨닫게 된 프로젝트였다.

</div>
</details>

<details>
<summary>PlaybackRate</summary>
<div markdown="1">

* Vinyl의 회전 속도에 따른 음악 재생속도를 맞춰야하는데, 정방향일때는 빠르게 감는 속도에 맞춰 playbackRate를 비례하게 올려주면 되는데, 역방향으로 감을 때는, 동일하게 음수값으로 주면 같은 효과가 생기지 않았다.
* 크롬 브라우저 환경에서는 playbackRate의 음수값 설정이 지원되지 않지만, safari 브라우저 환경에서는 지원이 됐다.
* web view를 사용해도 ios app개발을 하는 것이 처음 환경 설정이라서 expo-go에서 실행시킬때는 문제 없이 실행됐다.
* 개인적인 욕심으로 크롬 브라우저 환경에서도 실행시키고 싶어서, 역방향의 소리를 똑같이 만들어서 (reverse buffer) 뒤로 감을 때, 전체 시간에서 실행시간을 뺀값부터 실행시켜서 구현하려고 했는데, context의 currentTime이 음악을 실행시킨 시간부터가 아닌 audio context가 생성된 시점부터 시작된 값이라서 달랐다.
* 음악시간의 정확한 재생시간을 파악하는 것에 어려움이 있었지만, 기본  앱 환경에서는 정상 작동돼서 개인 욕심으로 해결하려는 문제로 전체 일정에 문제가 생길 것 같아서 보류해두었다.

</div>
</details>

<details>
<summary>녹음 품질</summary>
<div markdown="1">

* 처음 Record Component를 구현하려고 할때, BeatMaker Component에서 사용했던 부분 녹음과 같이 자체 mic를 이용해서 기기에서 나오는 소리를 녹음했다.
* 자체 소리도 잘 녹음이 안될 뿐아니라 다른 소리들도 들어가서 녹음 품질이 떨어졌다.
* 처음엔 각 context마다 녹음을 하고 만들어진 buffer를 합치려고 했는데, 효율적인 방법은 아니라고 판단했다.
* sound effect관련 레퍼런스보다가 Audio Bus를 이용해서 context관리하는 것을 봤던 것이 떠올랐다.
* Record에 사용되는 Audio Bus를 새로 만들어서 왼쪽, 오른쪽 Deck과 beatmaker stream을 각각 연결해서 녹음했다.
* 프로젝트를 하면서 Web Audio API를 점점 이해하면서, 흐름과 동작과정을 더 정확하게 알게 되면서, 내가 생각했던 방향으로 '이렇게 하면 구현되지 않을까?' 해서 구현하면 정상작동되는 부분들이 점차 많아졌다.
* 처음부터 특정 기술에 대해 완벽하게 이해하기는 힘들지만, 최대한 인내심을 가지고 공식문서를 정확하게 읽어보고 이해하고 구현하는 것이 시간을 단축할 수 있는 가장 빠른 방법이라는 것을 다시 한번 깨닫게 해주는 순간이었다.

</div>
</details>

# 🗓 프로젝트 일정

 ### 22.06.27 ~ 22.07.15 
* 1주차 (22.06.27 ~ 22.07.03)
	* 아이디어 확정
	* 기술 검증
	* 개발 환경 설정
* 2 ~ 3주차 (22.07.04 ~ 22.07.15)
	* vinyl에 따른 음악 맞추기
	* 녹음 기능 및 버튼 구현

📖 [회고](https://best-sousaphone-c1e.notion.site/7ddddab54000420b92ba2f3425814fb7)

# 보완할 점
* ~~녹음 기능 (수정 완료)~~
	* ~~외부 마이크를 사용해서 전체 녹음을 해서 불필요한소리들이 많이 들어감.~~
	* ~~각각 audio context에서 나오는 소리를 한곳에서 받아서 녹음하도록 수정~~
* ~~녹음 리스트 (수정 완료)~~
	* ~~녹음 버튼을 1.5초 이상 누르면 녹음 리스트가 나오는데 길게 터치하는게 모바일 환경에서 적용이 안되고 드래그가 됨.~~
* ~~각종 터치 (수정 완료)~~
	* ~~더블클릭에 확대되거나 손가락 두개를 사용할 경우 드래그나 확대되는 경우들 안되도록 수정.~~
* ~~Vinyl 움직임에 맞춘 음악 수정 (더 정교하도록) (수정 완료)~~
