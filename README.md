# Vinyla-Shake
Turn Table / audio Mixing / App

# 💡개발 동기

* 평소 개발 공부를 하면서 DJ Mix set 음악을 많이 들었는데, 음악 들으면서 도움도 많이 받았고, 장비들에 대한 호기심으로 시작하게 됐습니다. 
*  앱 개발에 대한 관심과 평소 DJ mix 앱에서 아쉬웠던 점인 user의 커스텀이 된 소리들을 넣으면 더 재밌지 않을까 생각했습니다.
* 대부분의 DJ앱은 유저의 음악파일에 직접 접근해서 가져오는데, ios의 경우 apple 뮤직에 저장되어있지 않으면 가져올 수 없다는 제약사항이 있어서,  단순 mp3 파일로 된 음악만 있다면 사용할 수 있도록 구현했습니다.

# 🛠 선택 기술

* Expo Go
* ES2015+
* storybook
* jest

# 🤷🏻‍♂️ 기술 선택 이유

* Expo Go
	* 앱 개발이 처음이고 빠르고 간단하게 개발환경 설정해주는 장점
	* WebView를 사용하기 때문에 React-Native의 라이브러리를 사용할 것들이 없어서 Expo Go로 결정.
* WebView?
	* 프로젝트에서 브라우저에서 제공하는 기본 Web Audio API 사용이 필수인데, Expo에서 제공하는 SDK(expo-av)가 Web Audio API의 기능들에 비해 적어서 WebView로 선택.
* Story Book
  * 시각적인 요소들이 대부분인 앱에서 부분별, UI테스트하기 적합하다고 판단.
* Vanilla JS (ES2015+)
	* React사용을 고민하다가 화면 전환이 필요없는 싱글 페이지이고, 지속적으로 변경되는 부분이 vinyl과 canvas(sound bar) 부분이라서, state변화에 따른 렌더링과 life cycle을 고민해야되는 React 사용보다는 vanilla JS를 사용하는게 더 적절하다고 판단했다.
  * 다른 라이브러리들을 많이 사용해서 그 라이브러리에 의존하기 보다는 vanilla JS만 사용해서 근본부터 시작해서 최대한 스스로 많이 구현해보고 싶다고 생각했다.

# 실행 화면

| 처음 화면  | 음악 가져오기 | 음악실행 / 녹음 | FX 버튼조작 | 녹음 리스트
|--|--|--|--|--|
| <img src="/assets/기본.jpg" /> | <img src="/assets/음악가져오기.jpg"/> | <img src="/assets/녹음.jpg" /> | <img src="/assets/FX버튼.jpeg" /> | <img src="/assets/녹음결과.jpg" /> |

# 🚬 고민들, 문제 해결과정

<details>
<summary>MVC와 Observer 패턴</summary>
<div markdown="1"> 

* 처음에는 함수형 프로그래밍을 적용시키려고 했지만, 부족한 조사와 경험으로 뒤늦게 함수형프로그래밍이 현재 프로젝트에 적합하지 않다는 것을 깨닫고, 다시 여러 디자인 패턴들을 현재 나의 프로젝트에 적합한지 더 자세히 조사해보고 선택하게 됐다.

* Observer 패턴을 선택한 이유는 audio context의 상태가 변함에 따라 vinyl, sound bars, record와 같은 컴포넌트들이 영향을 받아야 하기때문에 선택했다.

* 하나의 상태의 변화에 따라 다른 요소들이 독립적으로 변화에 따른 영향을 받는게 Observer 패턴을 적용시키는 데 적절한 것이라고 판단했다. 

* MVC를 나누는 것은 리액트의 state관리하듯 Model을 구성하고, 화면에 나오는 부분들은 View 클래스에, state에 데이터를 가공하는 곳은 Controller 클래스로 전체 구성을 구현해서 적용시켰다.

* Observer 패턴을 적용시킬땐,  observable한 객체와 observer로 설정할 것을 나눠서 observable 객체의 상태가 변할때 마다 notify를 해주어서 observer에게 알려주고, 상태 변화에 맞는 행동을 하는 로직으로 구현했다.

* 주로 AudioComponent가 Observable한 객체였고, 노래가 바뀔때마다 영향을 받는 요소들인 Vinyl Component, Sound bars, Effect Component들을 observer로 설정해두었다. 

* 처음 Web Audio Context에 대한 이해가 부족해서 먼저 어느정도 기능을 구현을 하고, 리팩토링을 하면서 디자인 패턴들을 적용시켰다.

* 리팩토링할때는 구조 나누는 것도 적용시키는 것도 너무 힘들었지만, 이후에 코드를 수정하거나 기능들을 추가할때, 너무 편하게 코드를 적을 수 있었다. 

* 전체 코드들이 눈에 들어오고, 어디에서 무슨 코드들이 있는지가 머릿속에 전부 있었다.

* 프로젝트에 맞는 적절한 디자인 패턴이 유지보수에 큰 도움이 된다는 걸 깨닫게 된 프로젝트였다.

</div>
</details>

<details>
<summary>PlaybackRate</summary>
<div markdown="1">

* Vinyl의 회전 속도에 따른 음악 재생속도를 맞춰야하는데, 정방향일때는 빠르게 감는 속도에 맞춰 playbackRate를 비례하게 올려주면 되는데, 역방향으로 감을 때는, 동일하게 음수값으로 주면 같은 효과가 생기지 않았다.
* 크롬 브라우저 환경에서는 playbackRate의 음수값 설정이 지원되지 않지만, safari 브라우저 환경에서는 지원이 됐다.
* web view를 사용해도 ios app개발을 하는 것이 처음 환경 설정이라서 expo-go에서 실행시킬때는 문제 없이 실행됐다.
* 개인적인 욕심으로 크롬 브라우저 환경에서도 실행시키고 싶어서, 역방향의 소리를 똑같이 만들어서 (reverse buffer) 뒤로 감을 때, 전체 시간에서 실행시간을 뺀값부터 실행시켜서 구현하려고 했는데, context의 currentTime이 음악을 실행시킨 시간부터가 아닌 audio context가 생성된 시점부터 시작된 값이라서 달랐다.
* 음악시간의 정확한 재생시간을 파악하는 것에 어려움이 있었지만, 기본  앱 환경에서는 정상 작동돼서 개인 욕심으로 해결하려는 문제로 전체 일정에 문제가 생길 것 같아서 보류해두었다.

</div>
</details>

# 🗓 프로젝트 일정

 ### 22.06.27 ~ 22.07.15 
* 1주차 (22.06.27 ~ 22.07.03)
	* 아이디어 확정
	* 기술 검증
	* 개발 환경 설정
* 2 ~ 3주차 (22.07.04 ~ 22.07.15)
	* vinyl에 따른 음악 맞추기
	* 녹음 기능 및 버튼 구현

# 보완할 점
* ~~녹음 기능 (수정 완료)~~
	* ~~외부 마이크를 사용해서 전체 녹음을 해서 불필요한소리들이 많이 들어감.~~
	* ~~각각 audio context에서 나오는 소리를 한곳에서 받아서 녹음하도록 수정~~
* ~~녹음 리스트 (수정 완료)~~
	* ~~녹음 버튼을 1.5초 이상 누르면 녹음 리스트가 나오는데 길게 터치하는게 모바일 환경에서 적용이 안되고 드래그가 됨.~~
* ~~각종 터치 (수정 완료)~~
	* ~~더블클릭에 확대되거나 손가락 두개를 사용할 경우 드래그나 확대되는 경우들 안되도록 수정.~~
* Vinyl 움직임에 맞춘 음악 수정 (더 정교하도록)
* cross fader 원래 소리 부터 조절하는 방식으로 수정
 